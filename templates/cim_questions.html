{% extends "base.html" %}

{% block title %}CIM Questions{% endblock %}

{% block content %}
  <div class="container py-2">
    <div class="row justify-content-center">
      <div class="col-lg-12">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0 pt-4 pb-3">
            <h2 class="text-center mb-2">CIM Questions</h2>
            <p class="text-center text-muted mb-0">Please fill out the information below to generate your analysis</p>
          </div>
          
          <div class="card-body p-4 p-md-5">
            {% if error %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              {{ error }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}
            {% if success %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
              {{ success }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            <form method="POST" action="/submit-cim" enctype="multipart/form-data">
              
              <!-- Personal Information Section -->
              <div class="mb-5">
                <h5 class="border-bottom pb-2 mb-4">Personal Information</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="full_name" class="form-label fw-semibold">Full Name</label>
                    <input type="text" class="form-control form-control-lg" id="full_name" name="full_name" required value="{{ form_data.full_name if form_data else '' }}">
                  </div>
                  <div class="col-md-6">
                    <label for="email" class="form-label fw-semibold">Email</label>
                    <input type="email" class="form-control form-control-lg" id="email" name="email" required value="{{ form_data.email if form_data else '' }}">
                  </div>
                </div>
              </div>

              <!-- Business Details Section -->
              <div class="mb-5">
                <h5 class="border-bottom pb-2 mb-4">Business Details</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="industry" class="form-label fw-semibold">Industry</label>
                    <input type="text" class="form-control form-control-lg" id="industry" name="industry"  value="{{ form_data.industry if form_data else '' }}">
                  </div>
                  <div class="col-md-6">
                    <label for="location" class="form-label fw-semibold">Location</label>
                    <input type="text" class="form-control form-control-lg" id="location" name="location"  value="{{ form_data.location if form_data else '' }}">
                  </div>
                </div>
              </div>

              <!-- Financial Information Section -->
              <div class="mb-5">
                <h5 class="border-bottom pb-2 mb-4">Financial Information</h5>
                <div class="row g-3">
                  <div class="col-md-3">
                    <label for="purchase_price" class="form-label fw-semibold">Purchase Price</label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text">$</span>
                      <input type="number" class="form-control" id="purchase_price" name="purchase_price" min="0" step="any"  value="{{ form_data.purchase_price if form_data else '' }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="revenue" class="form-label fw-semibold">Revenue</label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text">$</span>
                      <input type="number" class="form-control" id="revenue" name="revenue" min="0" step="any"  value="{{ form_data.revenue if form_data else '' }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="avg_sde" class="form-label fw-semibold">Avg SDE</label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text">$</span>
                      <input type="number" class="form-control" id="avg_sde" name="avg_sde" min="0" step="any"  value="{{ form_data.avg_sde if form_data else '' }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="total_adjustments" class="form-label fw-semibold">Total $ Adjustments</label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text">$</span>
                      <input type="number" class="form-control" id="total_adjustments" name="total_adjustments" min="0" step="any"  value="{{ form_data.total_adjustments if form_data else '' }}">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Deal Information Section -->
              <div class="mb-5">
                <h5 class="border-bottom pb-2 mb-4">Deal Information</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="seller_role" class="form-label fw-semibold">Seller Role</label>
                    <input type="text" class="form-control form-control-lg" id="seller_role" name="seller_role"  value="{{ form_data.seller_role if form_data else '' }}">
                  </div>
                  <div class="col-md-6">
                    <label for="reason_for_selling" class="form-label fw-semibold">Reason for Selling</label>
                    <input type="text" class="form-control form-control-lg" id="reason_for_selling" name="reason_for_selling"  value="{{ form_data.reason_for_selling if form_data else '' }}">
                  </div>
                </div>
                
                <div class="row g-3 mt-1">
                  <div class="col-md-12">
                    <label for="owner_involvement" class="form-label fw-semibold">Owner Involvement (high-level role description, hours per week, etc.)</label>
                    <textarea class="form-control" id="owner_involvement" name="owner_involvement" rows="3">{{ form_data.owner_involvement if form_data else '' }}</textarea>
                  </div>
                </div>

                <div class="row g-3 mt-1">
                  <div class="col-md-4">
                    <label for="gm_in_place" class="form-label fw-semibold">GM in Place?</label>
                    <select class="form-select form-select-lg" id="gm_in_place" name="gm_in_place">
                      <option value="">Select...</option>
                      <option value="Yes" {{ 'selected' if form_data and form_data.gm_in_place == 'Yes' else '' }}>Yes</option>
                      <option value="No" {{ 'selected' if form_data and form_data.gm_in_place == 'No' else '' }}>No</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label for="tenure_of_gm" class="form-label fw-semibold">Tenure of GM (if applicable)</label>
                    <input type="text" class="form-control form-control-lg" id="tenure_of_gm" name="tenure_of_gm"  value="{{ form_data.tenure_of_gm if form_data else '' }}">
                  </div>
                  <div class="col-md-4">
                    <label for="number_of_employees" class="form-label fw-semibold">Number of Employees</label>
                    <input type="number" class="form-control form-control-lg" id="number_of_employees" name="number_of_employees" min="0"  value="{{ form_data.number_of_employees if form_data else '' }}">
                  </div>
                </div>
              </div>

              <!-- Additional Questions Section -->
              <div class="mb-5">
                <h5 class="border-bottom pb-2 mb-4">Additional Questions</h5>
                
                <div class="mb-4">
                  <label for="cim_search_narrative_fit" class="form-label fw-semibold">Does the CIM fit your Search Narrative & your Search Narrative Question Guide?</label>
                  <select class="form-select form-select-lg" id="cim_search_narrative_fit" name="cim_search_narrative_fit" onchange="toggleSearchNarrative()">
                    <option value="">Select...</option>
                    <option value="Yes" {{ 'selected' if form_data and form_data.cim_search_narrative_fit == 'Yes' else '' }}>Yes</option>
                    <option value="No" {{ 'selected' if form_data and form_data.cim_search_narrative_fit == 'No' else '' }}>No</option>
                  </select>
                </div>

                <div class="mb-4" id="search_narrative_section" style="display: {{ 'block' if form_data and form_data.cim_search_narrative_fit == 'Yes' else 'none' }};">
                  <label for="search_narrative_relation" class="form-label fw-semibold">How does this relate to your search narrative?</label>
                  <textarea class="form-control" id="search_narrative_relation" name="search_narrative_relation" rows="4">{{ form_data.search_narrative_relation if form_data else '' }}</textarea>
                </div>

                <div class="mb-4">
                  <label for="deal_likes_dislikes" class="form-label fw-semibold">What do you like/don't like about the deal?</label>
                  <textarea class="form-control" id="deal_likes_dislikes" name="deal_likes_dislikes" rows="4" >{{ form_data.deal_likes_dislikes if form_data else '' }}</textarea>
                </div>

                <div class="mb-4">
                  <label for="deal_questions_concerns" class="form-label fw-semibold">What questions/concerns do you have about the deal?</label>
                  <textarea class="form-control" id="deal_questions_concerns" name="deal_questions_concerns" rows="4">{{ form_data.deal_questions_concerns if form_data else '' }}</textarea>
                </div>
              </div>

              <!-- File Upload Section -->
              <div class="mb-5">
                <h5 class="border-bottom pb-2 mb-4">Documents</h5>
                <div class="mb-3">
                  <label for="files" class="form-label fw-semibold">Upload all files that help us review your deal here</label>
                  <input type="file" class="form-control form-control-lg" id="files" name="files" multiple>
                  <div class="form-text">You can upload multiple files (PDF, Excel, Word, etc.)</div>
                </div>
              </div>

              <!-- Terms and Conditions -->
              <div class="mb-4">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="terms_accepted" name="terms_accepted" required>
                      <label class="form-check-label" for="terms_accepted">
                        <strong>Confirm terms and conditions:</strong> This data can be reviewed live on a call with others. We do not take any responsibility for it.
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex gap-3 justify-content-between flex-wrap">
                <a href="/" class="btn btn-outline-secondary rounded-pill btn-lg px-5">Back to Home</a>
                <button type="submit" class="btn submit-btn rounded-pill btn-lg px-5">Submit Information</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
function toggleSearchNarrative() {
  const select = document.getElementById('cim_search_narrative_fit');
  const section = document.getElementById('search_narrative_section');
  
  if (select.value === 'Yes') {
    section.style.display = 'block';
  } else {
    section.style.display = 'none';
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  toggleSearchNarrative();
});
</script>
{% endblock %}